name: .NET Core CI Main

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
    Configure:
        runs-on: windows-latest

        steps:
            - uses: actions/checkout@v2

            - name: Setup .NET Core
              uses: actions/setup-dotnet@v1
              with:
                  dotnet-version: 8.0.100
            
            - name: Install dependencies
              run: dotnet restore
    
    Build:
        needs: Configure
        runs-on: windows-latest

        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-dotnet@v1
              with:
                  dotnet-version: 8.0.100
            - name: Build
              run: dotnet build --configuration Release --no-restore
    Test:
        needs: Build
        runs-on: windows-latest

        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-dotnet@v1
              with:
                  dotnet-version: 8.0.100
            - name: Test
              run: dotnet test --no-restore --verbosity normal
    Publish:
        needs: Test
        runs-on: windows-latest

        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-dotnet@v1
              with:
                  dotnet-version: 8.0.100
            - name: Publish Main
              run: dotnet publish --configuration Release --no-build --project OldBarom.Web.Main

            - name: Publish API
              run: dotnet publish --configuration Release --no-build --project OldBarom.Web.API
            
        